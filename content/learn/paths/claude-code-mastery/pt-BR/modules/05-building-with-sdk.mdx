# Construindo com o SDK do Claude Code

O SDK do Claude Code permite que voc√™ construa integra√ß√µes personalizadas que estendem as capacidades do Claude para suas necessidades espec√≠ficas. Neste m√≥dulo, exploraremos a arquitetura do SDK, construiremos ferramentas personalizadas, criaremos utilit√°rios Unix e implantaremos suas integra√ß√µes.

## Objetivos de Aprendizagem

Ao final deste m√≥dulo, voc√™ ser√° capaz de:
- Navegar e entender a arquitetura do SDK do Claude Code
- Construir integra√ß√µes personalizadas adaptadas ao seu fluxo de trabalho
- Criar utilit√°rios Unix poderosos alimentados pelo Claude
- Empacotar e distribuir suas ferramentas Claude personalizadas

## Entendendo o SDK do Claude Code

O SDK fornece uma interface program√°tica para as capacidades do Claude, permitindo que voc√™ construa ferramentas que se integram perfeitamente com seu fluxo de trabalho de desenvolvimento.

### Vis√£o Geral da Arquitetura do SDK

<CodeExample language="typescript">
// Estrutura principal do SDK
import { ClaudeCode } from '@anthropic/claude-code-sdk';

// Componentes principais
const claude = new ClaudeCode({
  apiKey: process.env.CLAUDE_API_KEY,
  model: 'claude-3-opus-20240229',
  stream: true,
  maxTokens: 4096
});

// Interfaces principais
interface ClaudeRequest {
  prompt: string;
  context?: FileContext[];
  systemPrompt?: string;
  temperature?: number;
}

interface FileContext {
  path: string;
  content: string;
  language?: string;
}

interface ClaudeResponse {
  text: string;
  usage: TokenUsage;
  model: string;
  stopReason: 'stop' | 'max_tokens' | 'stop_sequence';
}
</CodeExample>

### Recursos Principais do SDK

<CodeExample language="typescript">
// 1. Completamento b√°sico
const response = await claude.complete({
  prompt: "Explique esta fun√ß√£o",
  context: [{
    path: "src/utils.js",
    content: readFileSync("src/utils.js", "utf-8")
  }]
});

// 2. Respostas em streaming
const stream = await claude.streamComplete({
  prompt: "Refatore este c√≥digo para melhor desempenho",
  context: loadProjectFiles("src/**/*.js")
});

for await (const chunk of stream) {
  process.stdout.write(chunk.text);
}

// 3. Gerenciamento de conversa
const conversation = claude.createConversation();
await conversation.add("user", "Como otimizo consultas de banco de dados?");
const response = await conversation.complete();

// 4. Integra√ß√£o de ferramentas
const tools = claude.defineTools([
  {
    name: "search_codebase",
    description: "Buscar padr√µes em c√≥digo",
    parameters: {
      pattern: "string",
      fileTypes: "string[]"
    }
  }
]);
</CodeExample>

### Configura√ß√£o do Ambiente

<CodeExample language="bash">
# Inicializar um novo projeto SDK
$ mkdir claude-custom-tool
$ cd claude-custom-tool
$ npm init -y

# Instalar SDK
$ npm install @anthropic/claude-code-sdk

# Instalar depend√™ncias de desenvolvimento
$ npm install -D typescript @types/node tsx

# Criar configura√ß√£o TypeScript
$ npx tsc --init

# Estrutura do projeto
claude-custom-tool/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ index.ts
‚îÇ   ‚îú‚îÄ‚îÄ commands/
‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îî‚îÄ‚îÄ types/
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ tsconfig.json
‚îî‚îÄ‚îÄ README.md
</CodeExample>

## Construindo Sua Primeira Integra√ß√£o Personalizada

Vamos construir uma ferramenta personalizada de revis√£o de c√≥digo que se integra com seu fluxo de trabalho Git.

### Projeto: Revisor de C√≥digo Consciente do Git

<CodeExample language="typescript">
// src/index.ts
import { ClaudeCode } from '@anthropic/claude-code-sdk';
import { exec } from 'child_process';
import { promisify } from 'util';
import { readFileSync } from 'fs';

const execAsync = promisify(exec);

class GitCodeReviewer {
  private claude: ClaudeCode;

  constructor(apiKey: string) {
    this.claude = new ClaudeCode({
      apiKey,
      model: 'claude-3-opus-20240229'
    });
  }

  async reviewChanges(branch: string = 'main'): Promise<void> {
    // Obter arquivos alterados
    const { stdout: changedFiles } = await execAsync(
      `git diff --name-only ${branch}...HEAD`
    );
    
    const files = changedFiles.trim().split('\n').filter(Boolean);
    
    if (files.length === 0) {
      console.log('Nenhuma altera√ß√£o para revisar');
      return;
    }

    // Revisar cada arquivo
    for (const file of files) {
      await this.reviewFile(file, branch);
    }
  }

  private async reviewFile(file: string, baseBranch: string): Promise<void> {
    console.log(`\nüìã Revisando: ${file}`);
    
    // Obter o diff
    const { stdout: diff } = await execAsync(
      `git diff ${baseBranch}...HEAD -- ${file}`
    );

    // Obter conte√∫do do arquivo
    let content: string;
    try {
      content = readFileSync(file, 'utf-8');
    } catch (error) {
      console.log(`  ‚ö†Ô∏è  Arquivo deletado ou movido`);
      return;
    }

    // Preparar prompt de revis√£o
    const prompt = `Revise esta mudan√ßa de c√≥digo e forne√ßa feedback sobre:
1. Qualidade do c√≥digo e melhores pr√°ticas
2. Bugs potenciais ou problemas
3. Considera√ß√µes de desempenho
4. Preocupa√ß√µes de seguran√ßa
5. Sugest√µes de melhoria

Arquivo: ${file}
Diff:
${diff}

Conte√∫do atual do arquivo:
${content}`;

    // Obter revis√£o do Claude
    const response = await this.claude.complete({
      prompt,
      systemPrompt: "Voc√™ √© um especialista revisor de c√≥digo. Seja construtivo mas completo."
    });

    console.log('\n' + response.text);
  }

  async reviewPR(prNumber: number): Promise<void> {
    console.log(`üîç Revisando PR #${prNumber}`);
    
    // Obter informa√ß√µes do PR usando GitHub CLI
    const { stdout: prInfo } = await execAsync(
      `gh pr view ${prNumber} --json files,title,body`
    );
    
    const pr = JSON.parse(prInfo);
    
    console.log(`\nT√≠tulo: ${pr.title}`);
    console.log(`Arquivos alterados: ${pr.files.length}`);
    
    // Revisar a descri√ß√£o do PR
    const descriptionReview = await this.claude.complete({
      prompt: `Revise esta descri√ß√£o de PR para clareza e completude:\n\n${pr.body}`,
      systemPrompt: "Sugira melhorias para tornar a descri√ß√£o do PR mais √∫til."
    });
    
    console.log('\nüìù Revis√£o da Descri√ß√£o do PR:');
    console.log(descriptionReview.text);
    
    // Revisar arquivos alterados
    await this.reviewChanges();
  }
}

// Interface CLI
async function main() {
  const reviewer = new GitCodeReviewer(process.env.CLAUDE_API_KEY!);
  const command = process.argv[2];
  
  switch (command) {
    case 'review':
      await reviewer.reviewChanges(process.argv[3] || 'main');
      break;
    case 'pr':
      const prNumber = parseInt(process.argv[3]);
      if (isNaN(prNumber)) {
        console.error('Por favor forne√ßa um n√∫mero de PR v√°lido');
        process.exit(1);
      }
      await reviewer.reviewPR(prNumber);
      break;
    default:
      console.log('Uso: claude-review review [branch] | pr <numero>');
  }
}

if (require.main === module) {
  main().catch(console.error);
}
</CodeExample>

### Adicionando Recursos Avan√ßados

<CodeExample language="typescript">
// src/commands/security-scan.ts
import { ClaudeCode } from '@anthropic/claude-code-sdk';
import { glob } from 'glob';
import { readFileSync } from 'fs';

export class SecurityScanner {
  constructor(private claude: ClaudeCode) {}

  async scanProject(pattern: string = '**/*.{js,ts,py,go}'): Promise<void> {
    const files = await glob(pattern, { ignore: ['node_modules/**'] });
    
    console.log(`üîê Escaneando ${files.length} arquivos para problemas de seguran√ßa...`);
    
    const issues: SecurityIssue[] = [];
    
    for (const file of files) {
      const content = readFileSync(file, 'utf-8');
      const fileIssues = await this.scanFile(file, content);
      issues.push(...fileIssues);
    }
    
    this.generateReport(issues);
  }

  private async scanFile(
    path: string, 
    content: string
  ): Promise<SecurityIssue[]> {
    const prompt = `Analise este c√≥digo para vulnerabilidades de seguran√ßa:
- Inje√ß√£o SQL
- Vulnerabilidades XSS  
- Credenciais codificadas
- Depend√™ncias inseguras
- Configura√ß√µes CORS incorretas
- Bypass de autentica√ß√£o
- Travessia de caminho
- Inje√ß√£o de comando

Retorne descobertas em formato JSON:
{
  "issues": [
    {
      "type": "tipo de vulnerabilidade",
      "severity": "high|medium|low",
      "line": numero_linha,
      "description": "descri√ß√£o detalhada",
      "recommendation": "como corrigir"
    }
  ]
}

Arquivo: ${path}
Conte√∫do:
${content}`;

    const response = await this.claude.complete({
      prompt,
      systemPrompt: "Voc√™ √© um especialista em seguran√ßa. Apenas reporte vulnerabilidades reais, n√£o problemas de estilo.",
      temperature: 0.1 // Temperatura mais baixa para an√°lise mais consistente
    });

    try {
      const result = JSON.parse(response.text);
      return result.issues.map((issue: any) => ({
        ...issue,
        file: path
      }));
    } catch (error) {
      console.error(`Falha ao analisar resposta para ${path}`);
      return [];
    }
  }

  private generateReport(issues: SecurityIssue[]): void {
    if (issues.length === 0) {
      console.log('\n‚úÖ Nenhum problema de seguran√ßa encontrado!');
      return;
    }

    console.log(`\n‚ö†Ô∏è  Encontrados ${issues.length} problemas de seguran√ßa:\n`);
    
    // Agrupar por severidade
    const grouped = issues.reduce((acc, issue) => {
      acc[issue.severity] = acc[issue.severity] || [];
      acc[issue.severity].push(issue);
      return acc;
    }, {} as Record<string, SecurityIssue[]>);

    // Exibir por severidade
    ['high', 'medium', 'low'].forEach(severity => {
      const severityIssues = grouped[severity] || [];
      if (severityIssues.length > 0) {
        console.log(`\n${severity.toUpperCase()} SEVERIDADE (${severityIssues.length}):`);
        severityIssues.forEach(issue => {
          console.log(`\n  üìç ${issue.file}:${issue.line}`);
          console.log(`     Tipo: ${issue.type}`);
          console.log(`     ${issue.description}`);
          console.log(`     üí° ${issue.recommendation}`);
        });
      }
    });
  }
}

interface SecurityIssue {
  file: string;
  type: string;
  severity: 'high' | 'medium' | 'low';
  line: number;
  description: string;
  recommendation: string;
}
</CodeExample>

## Criando Utilit√°rios Unix

Transforme Claude em utilit√°rios de linha de comando poderosos que seguem a filosofia Unix.

### Utilit√°rio Unix: Analisador de Complexidade de C√≥digo

<CodeExample language="typescript">
#!/usr/bin/env node
// src/bin/claude-complexity.ts

import { ClaudeCode } from '@anthropic/claude-code-sdk';
import { readFileSync } from 'fs';
import { program } from 'commander';

const claude = new ClaudeCode({
  apiKey: process.env.CLAUDE_API_KEY!
});

program
  .name('claude-complexity')
  .description('Analisar complexidade de c√≥digo usando Claude')
  .version('1.0.0')
  .argument('<files...>', 'arquivos para analisar')
  .option('-t, --threshold <number>', 'limite de complexidade', '10')
  .option('-f, --format <type>', 'formato de sa√≠da (json|table|markdown)', 'table')
  .option('-s, --sort <field>', 'ordenar por (complexity|file|functions)', 'complexity')
  .action(async (files, options) => {
    const results = [];

    for (const file of files) {
      try {
        const content = readFileSync(file, 'utf-8');
        const analysis = await analyzeComplexity(file, content);
        results.push(...analysis);
      } catch (error) {
        console.error(`Erro analisando ${file}:`, error.message);
      }
    }

    // Ordenar resultados
    results.sort((a, b) => {
      switch (options.sort) {
        case 'complexity':
          return b.complexity - a.complexity;
        case 'file':
          return a.file.localeCompare(b.file);
        case 'functions':
          return b.functionCount - a.functionCount;
        default:
          return 0;
      }
    });

    // Filtrar por limite
    const filtered = results.filter(r => r.complexity >= parseInt(options.threshold));

    // Sa√≠da dos resultados
    outputResults(filtered, options.format);
  });

async function analyzeComplexity(file: string, content: string) {
  const prompt = `Analise a complexidade ciclom√°tica deste c√≥digo.
Para cada fun√ß√£o/m√©todo, forne√ßa:
1. Nome da fun√ß√£o
2. Score de complexidade ciclom√°tica
3. N√∫mero da linha
4. Breve explica√ß√£o dos fatores de complexidade

Retorne como array JSON com esta estrutura:
[
  {
    "function": "nomeFuncao",
    "complexity": 15,
    "line": 42,
    "factors": ["loops aninhados", "m√∫ltiplas condi√ß√µes"],
    "recommendation": "considere dividir em fun√ß√µes menores"
  }
]

Arquivo: ${file}
Conte√∫do:
${content}`;

  const response = await claude.complete({
    prompt,
    temperature: 0.1
  });

  try {
    const functions = JSON.parse(response.text);
    return functions.map((fn: any) => ({
      file,
      ...fn,
      functionCount: functions.length
    }));
  } catch (error) {
    console.error(`Falha ao analisar complexidade para ${file}`);
    return [];
  }
}

function outputResults(results: any[], format: string) {
  switch (format) {
    case 'json':
      console.log(JSON.stringify(results, null, 2));
      break;
      
    case 'markdown':
      console.log('# Relat√≥rio de Complexidade de C√≥digo\n');
      console.log('| Arquivo | Fun√ß√£o | Complexidade | Linha | Fatores |');
      console.log('|---------|--------|--------------|-------|---------|');
      results.forEach(r => {
        console.log(
          `| ${r.file} | ${r.function} | ${r.complexity} | ${r.line} | ${r.factors.join(', ')} |`
        );
      });
      break;
      
    case 'table':
    default:
      console.table(
        results.map(r => ({
          Arquivo: r.file,
          Fun√ß√£o: r.function,
          Complexidade: r.complexity,
          Linha: r.line,
          Recomenda√ß√£o: r.recommendation
        }))
      );
  }
}

program.parse();
</CodeExample>

### Utilit√°rio Unix: Grep Inteligente com Contexto

<CodeExample language="typescript">
#!/usr/bin/env node
// src/bin/claude-grep.ts

import { ClaudeCode } from '@anthropic/claude-code-sdk';
import { readFileSync } from 'fs';
import { glob } from 'glob';
import chalk from 'chalk';

const claude = new ClaudeCode({
  apiKey: process.env.CLAUDE_API_KEY!
});

interface GrepOptions {
  context: number;
  explain: boolean;
  related: boolean;
  ignoreCase: boolean;
}

async function smartGrep(
  pattern: string,
  files: string[],
  options: GrepOptions
): Promise<void> {
  console.log(chalk.blue(`üîç Buscando por: ${pattern}\n`));

  for (const file of files) {
    const content = readFileSync(file, 'utf-8');
    const lines = content.split('\n');
    
    // Encontrar correspond√™ncias
    const matches: number[] = [];
    lines.forEach((line, index) => {
      const searchLine = options.ignoreCase ? line.toLowerCase() : line;
      const searchPattern = options.ignoreCase ? pattern.toLowerCase() : pattern;
      
      if (searchLine.includes(searchPattern)) {
        matches.push(index);
      }
    });

    if (matches.length > 0) {
      console.log(chalk.green(`\n${file}:`));
      
      for (const lineNum of matches) {
        // Mostrar contexto
        const start = Math.max(0, lineNum - options.context);
        const end = Math.min(lines.length - 1, lineNum + options.context);
        
        for (let i = start; i <= end; i++) {
          const prefix = i === lineNum ? chalk.red('>') : ' ';
          const lineNumber = chalk.gray(`${i + 1}:`);
          const line = i === lineNum 
            ? chalk.yellow(lines[i]) 
            : chalk.dim(lines[i]);
          
          console.log(`${prefix} ${lineNumber} ${line}`);
        }

        // Explicar se solicitado
        if (options.explain) {
          const explanation = await explainMatch(
            pattern,
            lines[lineNum],
            lines.slice(start, end + 1).join('\n')
          );
          console.log(chalk.cyan(`\n  üí° ${explanation}\n`));
        }
      }

      // Encontrar c√≥digo relacionado se solicitado
      if (options.related) {
        const related = await findRelated(
          pattern,
          file,
          content,
          matches
        );
        if (related.length > 0) {
          console.log(chalk.magenta('\n  üîó C√≥digo relacionado:'));
          related.forEach(r => {
            console.log(`     ${r.file}:${r.line} - ${r.description}`);
          });
        }
      }
    }
  }
}

async function explainMatch(
  pattern: string,
  line: string,
  context: string
): Promise<string> {
  const prompt = `Explique brevemente por que esta linha corresponde ao padr√£o de busca "${pattern}":

Linha: ${line}

Contexto:
${context}

Forne√ßa uma explica√ß√£o de uma linha.`;

  const response = await claude.complete({
    prompt,
    maxTokens: 100,
    temperature: 0.3
  });

  return response.text.trim();
}

async function findRelated(
  pattern: string,
  file: string,
  content: string,
  matchLines: number[]
): Promise<Array<{file: string, line: number, description: string}>> {
  const prompt = `Dadas essas correspond√™ncias de busca para "${pattern}" em ${file}, 
identifique outras se√ß√µes de c√≥digo relacionadas que podem ser relevantes:

Correspond√™ncias nas linhas: ${matchLines.map(l => l + 1).join(', ')}

Conte√∫do do arquivo:
${content}

Retorne um array JSON de localiza√ß√µes relacionadas:
[
  {
    "file": "mesmo arquivo ou sugira outros arquivos",
    "line": numero_linha,
    "description": "por que isso est√° relacionado"
  }
]

Limite a 3 localiza√ß√µes mais relevantes.`;

  const response = await claude.complete({
    prompt,
    temperature: 0.3
  });

  try {
    return JSON.parse(response.text);
  } catch {
    return [];
  }
}

// Configura√ß√£o CLI
const args = process.argv.slice(2);
const pattern = args[0];
const filePatterns = args.slice(1);

if (!pattern || filePatterns.length === 0) {
  console.log('Uso: claude-grep <pattern> <files...>');
  console.log('Op√ß√µes:');
  console.log('  -c, --context <n>  Mostrar n linhas de contexto (padr√£o: 2)');
  console.log('  -e, --explain      Explicar por que cada correspond√™ncia √© relevante');
  console.log('  -r, --related      Encontrar se√ß√µes de c√≥digo relacionadas');
  console.log('  -i, --ignore-case  Busca insens√≠vel a mai√∫sculas');
  process.exit(1);
}

// Analisar op√ß√µes (simplificado para exemplo)
const options: GrepOptions = {
  context: 2,
  explain: args.includes('-e') || args.includes('--explain'),
  related: args.includes('-r') || args.includes('--related'),
  ignoreCase: args.includes('-i') || args.includes('--ignore-case')
};

// Obter arquivos
const files: string[] = [];
for (const pattern of filePatterns) {
  if (!pattern.startsWith('-')) {
    const matched = await glob(pattern);
    files.push(...matched);
  }
}

smartGrep(pattern, files, options).catch(console.error);
</CodeExample>

<Quiz>
  <Question
    question="Qual √© a interface principal para interagir com Claude no SDK?"
    options={[
      "Classe ClaudeAPI",
      "Classe ClaudeCode", 
      "Classe ClaudeSDK",
      "Classe Claude"
    ]}
    correct={1}
    explanation="A classe ClaudeCode √© a interface principal para interagir com Claude atrav√©s do SDK, fornecendo m√©todos como complete() e streamComplete()."
  />
  
  <Question
    question="Ao construir utilit√°rios Unix com Claude, que princ√≠pio voc√™ deve seguir?"
    options={[
      "Torn√°-los o mais complexos poss√≠vel",
      "Incluir interfaces gr√°ficas",
      "Seguir a filosofia Unix - fazer uma coisa bem",
      "Evitar argumentos de linha de comando"
    ]}
    correct={2}
    explanation="Utilit√°rios Unix devem seguir a filosofia Unix: fazer uma coisa bem, ser compon√≠veis e funcionar bem com outras ferramentas atrav√©s de pipes e I/O padr√£o."
  />
  
  <Question
    question="Qual √© o benef√≠cio de usar respostas em streaming no SDK?"
    options={[
      "Usa menos mem√≥ria",
      "Fornece sa√≠da em tempo real conforme Claude gera",
      "√â obrigat√≥rio para todas as chamadas do SDK",
      "Torna as respostas mais precisas"
    ]}
    correct={1}
    explanation="Respostas em streaming permitem exibir sa√≠da em tempo real conforme Claude a gera, proporcionando melhor experi√™ncia do usu√°rio para respostas longas."
  />
  
  <Question
    question="O que voc√™ deve considerar ao reunir contexto para gera√ß√£o de c√≥digo?"
    options={[
      "Incluir todos os arquivos do projeto",
      "Incluir apenas o arquivo espec√≠fico sendo modificado",
      "Equilibrar relev√¢ncia com limites da janela de contexto",
      "Contexto n√£o importa para gera√ß√£o"
    ]}
    correct={2}
    explanation="Ao reunir contexto, equilibre incluir arquivos e padr√µes relevantes enquanto mant√©m dentro dos limites da janela de contexto para garantir gera√ß√£o efetiva."
  />
</Quiz>

## Empacotamento e Distribui√ß√£o

### Criando um Pacote NPM

<CodeExample language="json">
// package.json
{
  "name": "@seuusuario/claude-dev-tools",
  "version": "1.0.0",
  "description": "Ferramentas de desenvolvimento Claude personalizadas",
  "main": "dist/index.js",
  "types": "dist/index.d.ts",
  "bin": {
    "claude-review": "./dist/bin/claude-review.js",
    "claude-complexity": "./dist/bin/claude-complexity.js",
    "claude-grep": "./dist/bin/claude-grep.js"
  },
  "scripts": {
    "build": "tsc",
    "prepublishOnly": "npm run build",
    "test": "jest"
  },
  "files": [
    "dist",
    "README.md"
  ],
  "keywords": ["claude", "ai", "ferramentas-desenvolvimento"],
  "dependencies": {
    "@anthropic/claude-code-sdk": "^1.0.0",
    "commander": "^11.0.0",
    "chalk": "^5.3.0",
    "glob": "^10.3.0"
  },
  "devDependencies": {
    "@types/node": "^20.0.0",
    "typescript": "^5.0.0",
    "jest": "^29.0.0"
  }
}
</CodeExample>

### Publicando Suas Ferramentas

<CodeExample language="bash">
# Construir o pacote
$ npm run build

# Testar localmente
$ npm link
$ claude-review --help

# Executar testes
$ npm test

# Publicar no npm
$ npm login
$ npm publish --access public

# Usu√°rios agora podem instalar globalmente
$ npm install -g @seuusuario/claude-dev-tools
</CodeExample>

### Criando um Framework CLI

<CodeExample language="typescript">
// src/framework/claude-cli-framework.ts
export class ClaudeCliFramework {
  private commands: Map<string, Command> = new Map();

  constructor(
    private config: FrameworkConfig
  ) {
    this.setupGlobalOptions();
  }

  command(
    name: string,
    description: string,
    handler: CommandHandler
  ): this {
    this.commands.set(name, {
      name,
      description,
      handler,
      options: []
    });
    return this;
  }

  option(
    commandName: string,
    flags: string,
    description: string,
    defaultValue?: any
  ): this {
    const command = this.commands.get(commandName);
    if (command) {
      command.options.push({ flags, description, defaultValue });
    }
    return this;
  }

  async run(args: string[] = process.argv.slice(2)): Promise<void> {
    const commandName = args[0];
    const command = this.commands.get(commandName);

    if (!command) {
      this.showHelp();
      return;
    }

    try {
      // Analisar op√ß√µes
      const options = this.parseOptions(args.slice(1), command.options);
      
      // Criar inst√¢ncia Claude com config do framework
      const claude = new ClaudeCode(this.config.claude);
      
      // Executar comando
      await command.handler({
        claude,
        options,
        args: options._,
        config: this.config
      });
    } catch (error) {
      console.error(chalk.red(`Erro: ${error.message}`));
      process.exit(1);
    }
  }

  private showHelp(): void {
    console.log(`${this.config.name} - ${this.config.description}\n`);
    console.log('Comandos:');
    
    this.commands.forEach(cmd => {
      console.log(`  ${cmd.name.padEnd(15)} ${cmd.description}`);
    });
    
    console.log('\nUse "comando --help" para mais informa√ß√µes');
  }
}

// Exemplo de uso
const cli = new ClaudeCliFramework({
  name: 'minhas-ferramentas-claude',
  description: 'Ferramentas de desenvolvimento Claude personalizadas',
  claude: {
    apiKey: process.env.CLAUDE_API_KEY!,
    model: 'claude-3-opus-20240229'
  }
});

cli
  .command('analisar', 'Analisar qualidade do c√≥digo', async ({ claude, args }) => {
    const file = args[0];
    const content = readFileSync(file, 'utf-8');
    
    const analysis = await claude.complete({
      prompt: `Analise este c√≥digo para problemas de qualidade: ${content}`
    });
    
    console.log(analysis.text);
  })
  .option('analisar', '-d, --detalhado', 'Mostrar an√°lise detalhada')
  .option('analisar', '-f, --formato <tipo>', 'Formato de sa√≠da', 'texto');

cli.run();
</CodeExample>

## Exerc√≠cio Pr√°tico: Construa Sua Pr√≥pria Ferramenta Claude

Vamos construir um gerador de documenta√ß√£o completo que cria documenta√ß√£o bela e consciente do contexto.

### Projeto: Gerador de Documenta√ß√£o Inteligente

<CodeExample language="typescript">
// Exerc√≠cio: Complete este gerador de documenta√ß√£o

import { ClaudeCode } from '@anthropic/claude-code-sdk';
import { readFileSync, writeFileSync } from 'fs';
import { glob } from 'glob';
import { parse } from '@babel/parser';
import traverse from '@babel/traverse';

class SmartDocGenerator {
  constructor(private claude: ClaudeCode) {}

  async generateProjectDocs(projectPath: string): Promise<void> {
    // Tarefa 1: Analisar estrutura do projeto
    const structure = await this.analyzeStructure(projectPath);
    
    // Tarefa 2: Gerar documenta√ß√£o de vis√£o geral
    const overview = await this.generateOverview(structure);
    
    // Tarefa 3: Gerar documenta√ß√£o da API
    const apiDocs = await this.generateApiDocs(structure.files);
    
    // Tarefa 4: Gerar exemplos de uso
    const examples = await this.generateExamples(structure);
    
    // Tarefa 5: Compilar em markdown bonito
    const documentation = this.compileDocumentation({
      overview,
      apiDocs,
      examples,
      structure
    });
    
    writeFileSync('DOCUMENTACAO.md', documentation);
    console.log('üìö Documenta√ß√£o gerada com sucesso!');
  }

  private async analyzeStructure(projectPath: string): Promise<ProjectStructure> {
    // TODO: Implementar an√°lise de estrutura do projeto
    // Dica: Use glob para encontrar arquivos, analise package.json, identifique pontos de entrada
    throw new Error('Implemente analyzeStructure');
  }

  private async generateOverview(structure: ProjectStructure): Promise<string> {
    // TODO: Use Claude para gerar vis√£o geral do projeto
    // Inclua: prop√≥sito, arquitetura, recursos principais, come√ßando
    throw new Error('Implemente generateOverview');
  }

  private async generateApiDocs(files: FileInfo[]): Promise<ApiDocumentation> {
    // TODO: Analise arquivos e gere documenta√ß√£o da API
    // Extraia fun√ß√µes, classes, tipos e gere descri√ß√µes
    throw new Error('Implemente generateApiDocs');
  }

  private async generateExamples(structure: ProjectStructure): Promise<Example[]> {
    // TODO: Gere exemplos de uso baseados na API
    // Crie exemplos pr√°ticos e execut√°veis
    throw new Error('Implemente generateExamples');
  }

  private compileDocumentation(parts: DocumentationParts): string {
    // TODO: Compile todas as partes em documenta√ß√£o coesa
    // Adicione √≠ndice, formate bem
    throw new Error('Implemente compileDocumentation');
  }
}

// Desafios b√¥nus:
// 1. Adicionar suporte para m√∫ltiplos formatos de sa√≠da (Markdown, HTML, PDF)
// 2. Gerar documenta√ß√£o de API interativa com exemplos execut√°veis
// 3. Auto-gerar diagramas para visualiza√ß√£o de arquitetura
// 4. Criar documenta√ß√£o espec√≠fica por linguagem (JSDoc, docstrings Python, etc.)
// 5. Adicionar suporte a versionamento para documenta√ß√£o
</CodeExample>

### Tarefas do Exerc√≠cio

1. **Implementa√ß√£o B√°sica**: Complete todos os m√©todos TODO no SmartDocGenerator
2. **An√°lise Aprimorada**: Adicione gera√ß√£o de gr√°fico de depend√™ncias
3. **Documenta√ß√£o Interativa**: Crie uma vers√£o HTML com destaque de sintaxe
4. **Multi-linguagem**: Suporte projetos Python, Go e Rust
5. **Integra√ß√£o CI**: Crie GitHub Action para atualiza√ß√µes autom√°ticas de documenta√ß√£o

## Melhores Pr√°ticas para Desenvolvimento SDK

### Tratamento de Erros
- Sempre trate erros de API graciosamente
- Implemente l√≥gica de retry para falhas transit√≥rias
- Forne√ßa mensagens de erro significativas
- Registre erros para depura√ß√£o

### Otimiza√ß√£o de Desempenho
- Use streaming para respostas longas
- Implemente cache para consultas repetidas
- Agrupe requisi√ß√µes relacionadas
- Monitore uso de tokens

### Considera√ß√µes de Seguran√ßa
- Nunca codifique chaves API
- Valide todas as entradas
- Sanitize execu√ß√£o de c√≥digo
- Implemente limita√ß√£o de taxa

### Experi√™ncia do Usu√°rio
- Forne√ßa indicadores de progresso
- Suporte interrup√ß√£o/cancelamento
- Ofere√ßa m√∫ltiplos formatos de sa√≠da
- Inclua mensagens de erro √∫teis

## Estrat√©gias de Implanta√ß√£o

### Empacotamento Docker

<CodeExample language="dockerfile">
# Dockerfile para ferramentas Claude
FROM node:20-slim

WORKDIR /app

# Copiar arquivos de pacote
COPY package*.json ./
RUN npm ci --only=production

# Copiar arquivos constru√≠dos
COPY dist ./dist

# Configurar ambiente
ENV NODE_ENV=production

# Criar usu√°rio n√£o-root
RUN useradd -m -s /bin/bash claude
USER claude

# Expor verifica√ß√£o de sa√∫de
HEALTHCHECK CMD node dist/health.js

ENTRYPOINT ["node", "dist/bin/cli.js"]
</CodeExample>

### Integra√ß√£o GitHub Actions

<CodeExample language="yaml">
# .github/workflows/claude-tools.yml
name: Claude Tools CI/CD

on:
  push:
    branches: [main]
  pull_request:

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Configurar Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'
          
      - name: Instalar depend√™ncias
        run: npm ci
        
      - name: Executar testes
        run: npm test
        env:
          CLAUDE_API_KEY: ${{ secrets.CLAUDE_API_KEY }}
          
      - name: Construir
        run: npm run build
        
      - name: Publicar no NPM
        if: github.ref == 'refs/heads/main'
        run: npm publish
        env:
          NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}
</CodeExample>

## Principais Conclus√µes

1. **Poder do SDK**: O SDK do Claude Code permite construir ferramentas personalizadas poderosas
2. **Filosofia Unix**: Crie ferramentas focadas que fazem uma coisa bem
3. **Contexto Importa**: Coleta inteligente de contexto melhora resultados
4. **Experi√™ncia do Usu√°rio**: Boas ferramentas CLI s√£o intuitivas e √∫teis
5. **Distribui√ß√£o**: Empacote e compartilhe suas ferramentas com a comunidade

## Conclus√£o do Curso

Parab√©ns! Voc√™ dominou o Claude Code desde suas funda√ß√µes filos√≥ficas at√© a constru√ß√£o de integra√ß√µes personalizadas. Agora voc√™ tem o conhecimento para:

- Entender por que ferramentas de IA sem opini√£o importam
- Usar Claude Code efetivamente em todos os m√©todos de integra√ß√£o
- Implementar fluxos de trabalho avan√ßados como TDD e sess√µes paralelas
- Construir e distribuir suas pr√≥prias ferramentas alimentadas pelo Claude

### Seus Pr√≥ximos Passos

1. **Construa Algo**: Crie uma ferramenta personalizada que resolva um problema real em seu fluxo de trabalho
2. **Compartilhe Conhecimento**: Escreva sobre sua experi√™ncia com Claude Code
3. **Contribua**: Compartilhe suas ferramentas com a comunidade
4. **Mantenha-se Atualizado**: Acompanhe atualiza√ß√µes do Claude Code conforme as capacidades de IA evoluem

<Callout type="success">
Voc√™ agora est√° equipado para aproveitar IA como um verdadeiro parceiro de desenvolvimento, n√£o apenas um gerador de c√≥digo. O futuro da programa√ß√£o √© intelig√™ncia colaborativa‚Äîe voc√™ est√° pronto para mold√°-lo.
</Callout>

### Exerc√≠cio Final: Sua Ferramenta Personalizada

Construa e publique sua pr√≥pria ferramenta Claude Code que:
1. Resolva um problema espec√≠fico em seu fluxo de trabalho de desenvolvimento
2. Siga princ√≠pios da filosofia Unix
3. Forne√ßa excelente experi√™ncia do usu√°rio
4. Inclua documenta√ß√£o abrangente
5. Seja compartilhada com a comunidade (npm, GitHub, etc.)

Lembre-se: As melhores ferramentas v√™m de necessidades reais. O que voc√™ vai construir?